<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Auron</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Logto Browser SDK via ES Module -->
    <script type="module">
        import LogtoClient from 'https://esm.run/@logto/browser';
        window.LogtoClient = LogtoClient;
        window.logtoConfig = {
            endpoint: 'https://auth.neuralsyndicate.com/',
            appId: 'a5m87e4osv2y7vv8asbwu',
        };
        console.log('âœ“ Logto SDK loaded successfully');
    </script>

    <script src="./logto-config.js?v=3"></script>

    <!-- Our Modules -->
    <script src="./js/config.js"></script>
    <script src="./js/auth.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/shared.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#000DFF',
                        'primary-dark': '#001AFF',
                    },
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        body {
            background: #000000;
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Navigation, LoadingScreen } = window.SharedComponents;

        function ProfileApp() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [profile, setProfile] = useState(null);

            useEffect(() => {
                checkAuth();
            }, []);

            async function checkAuth() {
                const userData = await window.AuthUtils.requireAuth();
                if (userData) {
                    setUser(userData);
                    await loadProfile();
                    setLoading(false);
                }
            }

            async function loadProfile() {
                try {
                    const data = await window.API.getProfile();
                    setProfile(data);
                } catch (err) {
                    console.error('Failed to load profile:', err);
                    // Fallback to basic user data
                    setProfile({ error: err.message });
                }
            }

            async function handleSignOut() {
                await window.AuthUtils.signOut();
            }

            if (loading) {
                return <LoadingScreen />;
            }

            return (
                <div style={{ minHeight: '100vh', display: 'flex', flexDirection: 'column', background: '#000' }}>
                    <Navigation currentPage="/profile.html" user={user} onSignOut={handleSignOut} />

                    <div style={{ flex: 1, padding: '2rem' }}>
                        <div style={{ maxWidth: '800px', margin: '0 auto' }}>
                            <h1 style={{
                                fontSize: '2.5rem',
                                fontWeight: '900',
                                color: '#00D9FF',
                                textShadow: '0 0 20px rgba(0, 217, 255, 0.6)',
                                marginBottom: '2rem'
                            }}>
                                Your Profile
                            </h1>

                            <div style={{
                                background: 'rgba(255, 255, 255, 0.03)',
                                border: '1px solid rgba(255, 255, 255, 0.05)',
                                borderRadius: '1rem',
                                padding: '2rem'
                            }}>
                                {/* User Avatar */}
                                <div style={{
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '1.5rem',
                                    marginBottom: '2rem',
                                    paddingBottom: '2rem',
                                    borderBottom: '1px solid rgba(255, 255, 255, 0.05)'
                                }}>
                                    {user.picture ? (
                                        <img
                                            src={user.picture}
                                            alt={user.name}
                                            style={{
                                                width: '80px',
                                                height: '80px',
                                                borderRadius: '50%',
                                                border: '2px solid #00D9FF'
                                            }}
                                        />
                                    ) : (
                                        <div style={{
                                            width: '80px',
                                            height: '80px',
                                            borderRadius: '50%',
                                            background: 'linear-gradient(135deg, #000DFF 0%, #001AFF 100%)',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            fontSize: '2rem'
                                        }}>
                                            ðŸ‘¤
                                        </div>
                                    )}

                                    <div>
                                        <h2 style={{ fontSize: '1.5rem', fontWeight: '700', color: 'white', marginBottom: '0.25rem' }}>
                                            {user.name}
                                        </h2>
                                        {user.email && (
                                            <p style={{ color: '#9CA3AF', fontSize: '0.9rem' }}>
                                                {user.email}
                                            </p>
                                        )}
                                    </div>
                                </div>

                                {/* User Stats */}
                                <div style={{ marginBottom: '2rem' }}>
                                    <h3 style={{ fontSize: '1.25rem', fontWeight: '600', color: 'white', marginBottom: '1rem' }}>
                                        Statistics
                                    </h3>

                                    {profile?.error ? (
                                        <p style={{ color: '#EF4444' }}>
                                            Could not load profile stats: {profile.error}
                                        </p>
                                    ) : (
                                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '1rem' }}>
                                            <div style={{
                                                padding: '1rem',
                                                background: 'rgba(0, 13, 255, 0.1)',
                                                border: '1px solid rgba(0, 13, 255, 0.2)',
                                                borderRadius: '0.5rem',
                                                textAlign: 'center'
                                            }}>
                                                <p style={{ fontSize: '2rem', fontWeight: '700', color: '#00D9FF', marginBottom: '0.25rem' }}>
                                                    {profile?.conversations_count || 0}
                                                </p>
                                                <p style={{ color: '#9CA3AF', fontSize: '0.85rem' }}>Conversations</p>
                                            </div>

                                            <div style={{
                                                padding: '1rem',
                                                background: 'rgba(0, 13, 255, 0.1)',
                                                border: '1px solid rgba(0, 13, 255, 0.2)',
                                                borderRadius: '0.5rem',
                                                textAlign: 'center'
                                            }}>
                                                <p style={{ fontSize: '2rem', fontWeight: '700', color: '#00D9FF', marginBottom: '0.25rem' }}>
                                                    {profile?.patterns_count || 0}
                                                </p>
                                                <p style={{ color: '#9CA3AF', fontSize: '0.85rem' }}>Patterns</p>
                                            </div>

                                            <div style={{
                                                padding: '1rem',
                                                background: 'rgba(0, 13, 255, 0.1)',
                                                border: '1px solid rgba(0, 13, 255, 0.2)',
                                                borderRadius: '0.5rem',
                                                textAlign: 'center'
                                            }}>
                                                <p style={{ fontSize: '2rem', fontWeight: '700', color: '#00D9FF', marginBottom: '0.25rem' }}>
                                                    {profile?.days_active || 0}
                                                </p>
                                                <p style={{ color: '#9CA3AF', fontSize: '0.85rem' }}>Days Active</p>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Account Info */}
                                <div>
                                    <h3 style={{ fontSize: '1.25rem', fontWeight: '600', color: 'white', marginBottom: '1rem' }}>
                                        Account Information
                                    </h3>

                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', padding: '0.75rem 0', borderBottom: '1px solid rgba(255, 255, 255, 0.05)' }}>
                                            <span style={{ color: '#9CA3AF' }}>User ID</span>
                                            <span style={{ color: 'white', fontFamily: 'monospace', fontSize: '0.85rem' }}>{user.id}</span>
                                        </div>

                                        {user.email && (
                                            <div style={{ display: 'flex', justifyContent: 'space-between', padding: '0.75rem 0', borderBottom: '1px solid rgba(255, 255, 255, 0.05)' }}>
                                                <span style={{ color: '#9CA3AF' }}>Email</span>
                                                <span style={{ color: 'white' }}>{user.email}</span>
                                            </div>
                                        )}

                                        {profile?.joined_at && (
                                            <div style={{ display: 'flex', justifyContent: 'space-between', padding: '0.75rem 0' }}>
                                                <span style={{ color: '#9CA3AF' }}>Joined</span>
                                                <span style={{ color: 'white' }}>
                                                    {new Date(profile.joined_at).toLocaleDateString()}
                                                </span>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<ProfileApp />, document.getElementById('root'));
    </script>
</body>
</html>
